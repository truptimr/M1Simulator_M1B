% test M1DCS 6D sim in M1-B coordinate system
clc
clear
close all
%%inputs
tilt = 13.5; % tilt of the off axis mirror
clk = 0; % clocking angle of one of the off axis mirror.
zenith = 0;
% alpha = 1;
% Gravity force
[Fg, Mg, FMg] = decompose_gravity_vector(tilt,clk,zenith);

%% constants
% K = [    0         0         0         0         0         0;
%          0         0         0         0         0         0;
%     0.0004    0.0013   -0.0056    0.0049    0.0013         0;
%    -0.0115         0         0         0         0   -0.0026;
%          0   -0.0115         0         0         0   -0.0043;
%     0.0010    0.0005   -0.0066    0.0015    0.0025         0;
%    -0.0115         0         0         0         0    0.0026;
%          0   -0.0115         0         0         0   -0.0043;
%     0.0009   -0.0005   -0.0066   -0.0015    0.0025         0;
%    -0.0115         0         0         0         0   -0.0026;
%          0   -0.0115         0         0         0    0.0043;
%    -0.0010    0.0005   -0.0066    0.0015   -0.0025         0;
%    -0.0115         0         0         0         0    0.0026;
%          0   -0.0115         0         0         0    0.0043;
%    -0.0009   -0.0005   -0.0066   -0.0015   -0.0025         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%    -0.0010    0.0006   -0.0020    0.0007    0.0043         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%    -0.0011   -0.0005   -0.0020   -0.0007    0.0043         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%     0.0010   -0.0002   -0.0058   -0.0007    0.0047         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%     0.0009    0.0002   -0.0058    0.0007    0.0047         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%     0.0010    0.0006   -0.0020    0.0007   -0.0043         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%     0.0011   -0.0005   -0.0020   -0.0007   -0.0043         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%    -0.0010   -0.0002   -0.0058   -0.0007   -0.0047         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%    -0.0009    0.0001   -0.0058    0.0007   -0.0047         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%    -0.0005   -0.0006   -0.0030   -0.0039   -0.0030         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%     0.0001    0.0005   -0.0047   -0.0035   -0.0029         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%     0.0005   -0.0006   -0.0030   -0.0039    0.0030         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%    -0.0001    0.0005   -0.0047   -0.0035    0.0029         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%    -0.0005    0.0006   -0.0030    0.0039   -0.0030         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%     0.0001   -0.0005   -0.0047    0.0035   -0.0029         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%     0.0005    0.0006   -0.0030    0.0039    0.0030         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%    -0.0001   -0.0005   -0.0047    0.0035    0.0029         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%    -0.0003    0.0014   -0.0068   -0.0044    0.0003         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%     0.0000    0.0017   -0.0070   -0.0044    0.0011         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%    -0.0004    0.0018   -0.0064   -0.0036    0.0021         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%    -0.0016    0.0012   -0.0067   -0.0029    0.0033         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%    -0.0017    0.0007   -0.0070   -0.0022    0.0037         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%    -0.0014    0.0016   -0.0067   -0.0015    0.0041         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%    -0.0013    0.0001   -0.0068   -0.0000    0.0041         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%    -0.0003   -0.0013   -0.0067    0.0044    0.0003         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%    -0.0000   -0.0016   -0.0069    0.0044    0.0011         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%    -0.0005   -0.0017   -0.0064    0.0036    0.0021         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%    -0.0016   -0.0012   -0.0067    0.0029    0.0033         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%    -0.0017   -0.0007   -0.0070    0.0022    0.0037         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%    -0.0014   -0.0015   -0.0066    0.0015    0.0041         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%     0.0003    0.0014   -0.0068   -0.0044   -0.0003         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%    -0.0000    0.0017   -0.0070   -0.0044   -0.0011         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%     0.0004    0.0018   -0.0064   -0.0036   -0.0021         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%     0.0016    0.0012   -0.0067   -0.0029   -0.0033         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%     0.0017    0.0007   -0.0070   -0.0022   -0.0037         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%     0.0014    0.0016   -0.0067   -0.0015   -0.0041         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%     0.0013    0.0001   -0.0068   -0.0000   -0.0041         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%     0.0003   -0.0013   -0.0067    0.0044   -0.0003         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%     0.0000   -0.0016   -0.0069    0.0044   -0.0011         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%     0.0005   -0.0017   -0.0064    0.0036   -0.0021         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%     0.0016   -0.0012   -0.0067    0.0029   -0.0033         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%     0.0017   -0.0007   -0.0070    0.0022   -0.0037         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%     0.0014   -0.0015   -0.0066    0.0015   -0.0041         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%     0.0004   -0.0007   -0.0031   -0.0047    0.0019         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%     0.0014   -0.0003   -0.0024   -0.0013    0.0047         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%     0.0004    0.0007   -0.0031    0.0047    0.0019         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%     0.0013    0.0002   -0.0024    0.0013    0.0047         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%     0.0004   -0.0019   -0.0061   -0.0051    0.0004         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%     0.0004   -0.0014   -0.0056   -0.0049    0.0013         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%     0.0007   -0.0016   -0.0060   -0.0043    0.0025         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%     0.0013   -0.0011   -0.0048   -0.0035    0.0035         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%     0.0009   -0.0006   -0.0059   -0.0027    0.0041         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%    -0.0004    0.0002   -0.0039   -0.0041    0.0019         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%     0.0014   -0.0005   -0.0055   -0.0019    0.0045         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%     0.0008   -0.0000   -0.0056   -0.0000    0.0048         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%     0.0004    0.0018   -0.0061    0.0051    0.0004         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%     0.0007    0.0015   -0.0060    0.0043    0.0025         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%     0.0013    0.0011   -0.0048    0.0035    0.0035         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%     0.0009    0.0006   -0.0059    0.0027    0.0041         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%    -0.0004   -0.0002   -0.0038    0.0041    0.0019         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%     0.0013    0.0005   -0.0055    0.0019    0.0045         0;
%    -0.0127         0         0         0         0    0.0013;
%          0   -0.0128         0         0         0   -0.0009;
%     0.0015   -0.0003   -0.0063   -0.0007    0.0005         0;
%    -0.0116         0         0         0         0    0.0039;
%          0   -0.0116         0         0         0   -0.0009;
%     0.0009   -0.0003   -0.0066   -0.0022    0.0005         0;
%    -0.0113         0         0         0         0    0.0066;
%          0   -0.0113         0         0         0   -0.0009;
%     0.0012    0.0014   -0.0071   -0.0036    0.0005         0;
%    -0.0118         0         0         0         0    0.0026;
%          0   -0.0118         0         0         0   -0.0016;
%     0.0004   -0.0002   -0.0058   -0.0015    0.0009         0;
%    -0.0114         0         0         0         0    0.0053;
%          0   -0.0114         0         0         0   -0.0016;
%     0.0006   -0.0008   -0.0060   -0.0029    0.0009         0;
%    -0.0115         0         0         0         0    0.0039;
%          0   -0.0115         0         0         0   -0.0023;
%     0.0006   -0.0012   -0.0066   -0.0022    0.0013         0;
%    -0.0113         0         0         0         0    0.0066;
%          0   -0.0113         0         0         0   -0.0023;
%    -0.0014    0.0013   -0.0071   -0.0036    0.0013         0;
%    -0.0117         0         0         0         0    0.0026;
%          0   -0.0117         0         0         0   -0.0029;
%     0.0006   -0.0003   -0.0065   -0.0015    0.0017         0;
%    -0.0114         0         0         0         0    0.0053;
%          0   -0.0114         0         0         0   -0.0029;
%    -0.0001    0.0003   -0.0069   -0.0029    0.0017         0;
%    -0.0115         0         0         0         0    0.0039;
%          0   -0.0115         0         0         0   -0.0036;
%     0.0008   -0.0005   -0.0064   -0.0022    0.0021         0;
%    -0.0114         0         0         0         0    0.0053;
%          0   -0.0114         0         0         0   -0.0043;
%    -0.0012    0.0016   -0.0072   -0.0029    0.0025         0;
%    -0.0114         0         0         0         0    0.0039;
%          0   -0.0114         0         0         0   -0.0050;
%    -0.0013    0.0006   -0.0069   -0.0022    0.0029         0;
%    -0.0115         0         0         0         0    0.0026;
%          0   -0.0115         0         0         0   -0.0056;
%    -0.0014    0.0006   -0.0067   -0.0015    0.0033         0;
%    -0.0122         0         0         0         0    0.0013;
%          0   -0.0121         0         0         0   -0.0023;
%     0.0003   -0.0002   -0.0063   -0.0007    0.0013         0;
%    -0.0118         0         0         0         0    0.0013;
%          0   -0.0118         0         0         0   -0.0036;
%     0.0009   -0.0003   -0.0063   -0.0007    0.0021         0;
%    -0.0132         0         0         0         0   -0.0000;
%          0   -0.0131         0         0         0   -0.0016;
%     0.0009   -0.0000   -0.0057    0.0000    0.0009         0;
%    -0.0121         0         0         0         0   -0.0000;
%          0   -0.0121         0         0         0   -0.0029;
%     0.0002   -0.0000   -0.0064    0.0000    0.0017         0;
%    -0.0116         0         0         0         0    0.0013;
%          0   -0.0116         0         0         0   -0.0050;
%     0.0005   -0.0002   -0.0066   -0.0007    0.0029         0;
%    -0.0115         0         0         0         0    0.0013;
%          0   -0.0115         0         0         0   -0.0063;
%    -0.0014    0.0000   -0.0072   -0.0007    0.0037         0;
%    -0.0117         0         0         0         0    0.0000;
%          0   -0.0117         0         0         0   -0.0043;
%     0.0012   -0.0000   -0.0065   -0.0000    0.0025         0;
%    -0.0115         0         0         0         0   -0.0000;
%          0   -0.0115         0         0         0   -0.0056;
%    -0.0008   -0.0000   -0.0067    0.0000    0.0033         0;
%    -0.0127         0         0         0         0   -0.0013;
%          0   -0.0128         0         0         0   -0.0009;
%     0.0015    0.0003   -0.0063    0.0007    0.0005         0;
%    -0.0115         0         0         0         0   -0.0039;
%          0   -0.0116         0         0         0   -0.0009;
%     0.0008    0.0004   -0.0065    0.0022    0.0005         0;
%    -0.0113         0         0         0         0   -0.0066;
%          0   -0.0113         0         0         0   -0.0009;
%     0.0011   -0.0014   -0.0071    0.0036    0.0005         0;
%    -0.0118         0         0         0         0   -0.0026;
%          0   -0.0118         0         0         0   -0.0016;
%     0.0004    0.0002   -0.0057    0.0015    0.0009         0;
%    -0.0114         0         0         0         0   -0.0053;
%          0   -0.0114         0         0         0   -0.0016;
%     0.0006    0.0009   -0.0060    0.0029    0.0009         0;
%    -0.0115         0         0         0         0   -0.0039;
%          0   -0.0115         0         0         0   -0.0023;
%     0.0006    0.0012   -0.0066    0.0022    0.0013         0;
%    -0.0113         0         0         0         0   -0.0066;
%          0   -0.0113         0         0         0   -0.0023;
%    -0.0014   -0.0013   -0.0070    0.0036    0.0013         0;
%    -0.0117         0         0         0         0   -0.0026;
%          0   -0.0117         0         0         0   -0.0029;
%     0.0006    0.0003   -0.0065    0.0015    0.0017         0;
%    -0.0114         0         0         0         0   -0.0053;
%          0   -0.0114         0         0         0   -0.0029;
%    -0.0001   -0.0003   -0.0068    0.0029    0.0017         0;
%    -0.0114         0         0         0         0   -0.0039;
%          0   -0.0115         0         0         0   -0.0036;
%     0.0008    0.0005   -0.0064    0.0022    0.0021         0;
%    -0.0113         0         0         0         0   -0.0053;
%          0   -0.0113         0         0         0   -0.0043;
%    -0.0012   -0.0016   -0.0072    0.0029    0.0025         0;
%    -0.0114         0         0         0         0   -0.0039;
%          0   -0.0114         0         0         0   -0.0050;
%    -0.0013   -0.0006   -0.0068    0.0022    0.0029         0;
%    -0.0114         0         0         0         0   -0.0026;
%          0   -0.0115         0         0         0   -0.0056;
%    -0.0013   -0.0006   -0.0067    0.0015    0.0033         0;
%    -0.0122         0         0         0         0   -0.0013;
%          0   -0.0121         0         0         0   -0.0023;
%     0.0003    0.0001   -0.0063    0.0007    0.0013         0;
%    -0.0118         0         0         0         0   -0.0013;
%          0   -0.0118         0         0         0   -0.0036;
%     0.0009    0.0003   -0.0063    0.0007    0.0021         0;
%    -0.0116         0         0         0         0   -0.0013;
%          0   -0.0116         0         0         0   -0.0050;
%     0.0005    0.0002   -0.0066    0.0007    0.0029         0;
%    -0.0115         0         0         0         0   -0.0013;
%          0   -0.0115         0         0         0   -0.0063;
%    -0.0014    0.0000   -0.0072    0.0007    0.0037         0;
%    -0.0135         0         0         0         0   -0.0000;
%          0   -0.0135         0         0         0         0;
%     0.0000   -0.0000   -0.0102    0.0000         0         0;
%    -0.0135         0         0         0         0    0.0026;
%          0   -0.0135         0         0         0         0;
%     0.0000   -0.0009   -0.0104   -0.0015         0         0;
%    -0.0135         0         0         0         0    0.0053;
%          0   -0.0135         0         0         0         0;
%    -0.0000   -0.0010   -0.0110   -0.0029         0         0;
%    -0.0135         0         0         0         0   -0.0026;
%          0   -0.0135         0         0         0         0;
%    -0.0000    0.0009   -0.0104    0.0015         0         0;
%    -0.0135         0         0         0         0   -0.0053;
%          0   -0.0135         0         0         0         0;
%    -0.0000    0.0010   -0.0109    0.0029         0         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%    -0.0004   -0.0007   -0.0031   -0.0047   -0.0019         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%    -0.0014   -0.0003   -0.0024   -0.0013   -0.0047         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%    -0.0004    0.0007   -0.0031    0.0047   -0.0019         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%    -0.0014    0.0002   -0.0024    0.0013   -0.0047         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%    -0.0004   -0.0019   -0.0061   -0.0051   -0.0004         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%    -0.0004   -0.0014   -0.0056   -0.0049   -0.0013         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%    -0.0007   -0.0016   -0.0060   -0.0043   -0.0025         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%    -0.0013   -0.0011   -0.0048   -0.0035   -0.0035         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%    -0.0009   -0.0006   -0.0059   -0.0027   -0.0041         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%     0.0004    0.0002   -0.0039   -0.0041   -0.0019         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%    -0.0014   -0.0005   -0.0055   -0.0019   -0.0045         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%    -0.0008   -0.0000   -0.0056   -0.0000   -0.0048         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%    -0.0004    0.0018   -0.0061    0.0051   -0.0004         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%    -0.0004    0.0013   -0.0056    0.0049   -0.0013         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%    -0.0007    0.0015   -0.0060    0.0043   -0.0025         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%    -0.0013    0.0011   -0.0048    0.0035   -0.0035         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%    -0.0009    0.0006   -0.0059    0.0027   -0.0041         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%     0.0004   -0.0002   -0.0038    0.0041   -0.0019         0;
%          0         0         0         0         0         0;
%          0         0         0         0         0         0;
%    -0.0013    0.0005   -0.0055    0.0019   -0.0045         0;
%    -0.0127         0         0         0         0    0.0013;
%          0   -0.0128         0         0         0    0.0009;
%    -0.0015   -0.0003   -0.0063   -0.0007   -0.0005         0;
%    -0.0116         0         0         0         0    0.0039;
%          0   -0.0116         0         0         0    0.0009;
%    -0.0009   -0.0003   -0.0066   -0.0022   -0.0005         0;
%    -0.0113         0         0         0         0    0.0066;
%          0   -0.0113         0         0         0    0.0009;
%    -0.0012    0.0014   -0.0071   -0.0036   -0.0005         0;
%    -0.0118         0         0         0         0    0.0026;
%          0   -0.0118         0         0         0    0.0016;
%    -0.0004   -0.0002   -0.0058   -0.0015   -0.0009         0;
%    -0.0114         0         0         0         0    0.0053;
%          0   -0.0114         0         0         0    0.0016;
%    -0.0006   -0.0008   -0.0060   -0.0029   -0.0009         0;
%    -0.0115         0         0         0         0    0.0039;
%          0   -0.0115         0         0         0    0.0023;
%    -0.0006   -0.0012   -0.0066   -0.0022   -0.0013         0;
%    -0.0113         0         0         0         0    0.0066;
%          0   -0.0113         0         0         0    0.0023;
%     0.0014    0.0013   -0.0071   -0.0036   -0.0013         0;
%    -0.0117         0         0         0         0    0.0026;
%          0   -0.0117         0         0         0    0.0029;
%    -0.0006   -0.0003   -0.0065   -0.0015   -0.0017         0;
%    -0.0114         0         0         0         0    0.0053;
%          0   -0.0114         0         0         0    0.0029;
%     0.0001    0.0003   -0.0069   -0.0029   -0.0017         0;
%    -0.0115         0         0         0         0    0.0039;
%          0   -0.0115         0         0         0    0.0036;
%    -0.0008   -0.0005   -0.0064   -0.0022   -0.0021         0;
%    -0.0114         0         0         0         0    0.0053;
%          0   -0.0114         0         0         0    0.0043;
%     0.0012    0.0016   -0.0072   -0.0029   -0.0025         0;
%    -0.0114         0         0         0         0    0.0039;
%          0   -0.0114         0         0         0    0.0050;
%     0.0013    0.0006   -0.0069   -0.0022   -0.0029         0;
%    -0.0115         0         0         0         0    0.0026;
%          0   -0.0115         0         0         0    0.0056;
%     0.0014    0.0006   -0.0067   -0.0015   -0.0033         0;
%    -0.0122         0         0         0         0    0.0013;
%          0   -0.0121         0         0         0    0.0023;
%    -0.0003   -0.0002   -0.0063   -0.0007   -0.0013         0;
%    -0.0118         0         0         0         0    0.0013;
%          0   -0.0118         0         0         0    0.0036;
%    -0.0009   -0.0003   -0.0063   -0.0007   -0.0021         0;
%    -0.0132         0         0         0         0   -0.0000;
%          0   -0.0131         0         0         0    0.0016;
%    -0.0009   -0.0000   -0.0057    0.0000   -0.0009         0;
%    -0.0121         0         0         0         0   -0.0000;
%          0   -0.0121         0         0         0    0.0029;
%    -0.0002   -0.0000   -0.0064    0.0000   -0.0017         0;
%    -0.0116         0         0         0         0    0.0013;
%          0   -0.0116         0         0         0    0.0050;
%    -0.0005   -0.0002   -0.0066   -0.0007   -0.0029         0;
%    -0.0115         0         0         0         0    0.0013;
%          0   -0.0115         0         0         0    0.0063;
%     0.0014    0.0000   -0.0072   -0.0007   -0.0037         0;
%    -0.0118         0         0         0         0    0.0000;
%          0   -0.0117         0         0         0    0.0043;
%    -0.0012   -0.0000   -0.0065   -0.0000   -0.0025         0;
%    -0.0115         0         0         0         0   -0.0000;
%          0   -0.0115         0         0         0    0.0056;
%     0.0008   -0.0000   -0.0067    0.0000   -0.0033         0;
%    -0.0127         0         0         0         0   -0.0013;
%          0   -0.0128         0         0         0    0.0009;
%    -0.0015    0.0003   -0.0063    0.0007   -0.0005         0;
%    -0.0115         0         0         0         0   -0.0039;
%          0   -0.0116         0         0         0    0.0009;
%    -0.0008    0.0004   -0.0065    0.0022   -0.0005         0;
%    -0.0113         0         0         0         0   -0.0066;
%          0   -0.0113         0         0         0    0.0009;
%    -0.0011   -0.0014   -0.0071    0.0036   -0.0005         0;
%    -0.0118         0         0         0         0   -0.0026;
%          0   -0.0118         0         0         0    0.0016;
%    -0.0004    0.0002   -0.0057    0.0015   -0.0009         0;
%    -0.0114         0         0         0         0   -0.0053;
%          0   -0.0114         0         0         0    0.0016;
%    -0.0006    0.0009   -0.0060    0.0029   -0.0009         0;
%    -0.0115         0         0         0         0   -0.0039;
%          0   -0.0115         0         0         0    0.0023;
%    -0.0006    0.0012   -0.0066    0.0022   -0.0013         0;
%    -0.0113         0         0         0         0   -0.0066;
%          0   -0.0113         0         0         0    0.0023;
%     0.0014   -0.0013   -0.0070    0.0036   -0.0013         0;
%    -0.0117         0         0         0         0   -0.0026;
%          0   -0.0117         0         0         0    0.0029;
%    -0.0006    0.0003   -0.0065    0.0015   -0.0017         0;
%    -0.0114         0         0         0         0   -0.0053;
%          0   -0.0114         0         0         0    0.0029;
%     0.0001   -0.0003   -0.0068    0.0029   -0.0017         0;
%    -0.0114         0         0         0         0   -0.0039;
%          0   -0.0115         0         0         0    0.0036;
%    -0.0008    0.0005   -0.0064    0.0022   -0.0021         0;
%    -0.0113         0         0         0         0   -0.0053;
%          0   -0.0113         0         0         0    0.0043;
%     0.0012   -0.0016   -0.0072    0.0029   -0.0025         0;
%    -0.0114         0         0         0         0   -0.0039;
%          0   -0.0114         0         0         0    0.0050;
%     0.0013   -0.0006   -0.0068    0.0022   -0.0029         0;
%    -0.0057         0         0         0         0   -0.0013;
%          0   -0.0057         0         0         0    0.0028;
%     0.0007   -0.0003   -0.0033    0.0007   -0.0017         0;
%    -0.0061         0         0         0         0   -0.0007;
%          0   -0.0061         0         0         0    0.0011;
%    -0.0002    0.0001   -0.0032    0.0004   -0.0007         0;
%    -0.0059         0         0         0         0   -0.0007;
%          0   -0.0059         0         0         0    0.0018;
%    -0.0005    0.0002   -0.0031    0.0004   -0.0011         0;
%    -0.0058         0         0         0         0   -0.0007;
%          0   -0.0058         0         0         0    0.0025;
%    -0.0003    0.0001   -0.0033    0.0004   -0.0015         0;
%    -0.0057         0         0         0         0   -0.0007;
%          0   -0.0057         0         0         0    0.0032;
%     0.0007    0.0000   -0.0036    0.0004   -0.0019         0;
%    -0.0057         0         0         0         0   -0.0013;
%          0   -0.0057         0         0         0    0.0028;
%     0.0007   -0.0003   -0.0033    0.0007   -0.0017         0;
%    -0.0061         0         0         0         0   -0.0007;
%          0   -0.0061         0         0         0    0.0011;
%    -0.0002    0.0001   -0.0032    0.0004   -0.0007         0;
%    -0.0059         0         0         0         0   -0.0007;
%          0   -0.0059         0         0         0    0.0018;
%    -0.0005    0.0002   -0.0031    0.0004   -0.0011         0;
%    -0.0058         0         0         0         0   -0.0007;
%          0   -0.0058         0         0         0    0.0025;
%    -0.0003    0.0001   -0.0033    0.0004   -0.0015         0;
%    -0.0057         0         0         0         0   -0.0007;
%          0   -0.0057         0         0         0    0.0032;
%     0.0007    0.0000   -0.0036    0.0004   -0.0019         0];
K = [   -0.0132         0         0         0         0   -0.0000
         0   -0.0131         0         0         0    0.0016
   -0.0009   -0.0000   -0.0057    0.0000   -0.0009         0
   -0.0121         0         0         0         0   -0.0000
         0   -0.0121         0         0         0    0.0029
   -0.0002   -0.0000   -0.0064    0.0000   -0.0017         0
   -0.0118         0         0         0         0    0.0000
         0   -0.0117         0         0         0    0.0043
   -0.0012   -0.0000   -0.0065   -0.0000   -0.0025         0
   -0.0115         0         0         0         0   -0.0000
         0   -0.0115         0         0         0    0.0056
    0.0008   -0.0000   -0.0067    0.0000   -0.0033         0
         0         0         0         0         0         0
         0         0         0         0         0         0
    0.0013    0.0001   -0.0068   -0.0000   -0.0041         0
         0         0         0         0         0         0
         0         0         0         0         0         0
   -0.0008   -0.0000   -0.0056   -0.0000   -0.0048         0
   -0.0127         0         0         0         0   -0.0013
         0   -0.0128         0         0         0    0.0009
   -0.0015    0.0003   -0.0063    0.0007   -0.0005         0
   -0.0061         0         0         0         0   -0.0007
         0   -0.0061         0         0         0    0.0011
   -0.0002    0.0001   -0.0032    0.0004   -0.0007         0
   -0.0059         0         0         0         0   -0.0007
         0   -0.0059         0         0         0    0.0018
   -0.0005    0.0002   -0.0031    0.0004   -0.0011         0
   -0.0058         0         0         0         0   -0.0007
         0   -0.0058         0         0         0    0.0025
   -0.0003    0.0001   -0.0033    0.0004   -0.0015         0
   -0.0057         0         0         0         0   -0.0007
         0   -0.0057         0         0         0    0.0032
    0.0007    0.0000   -0.0036    0.0004   -0.0019         0
         0         0         0         0         0         0
         0         0         0         0         0         0
    0.0010    0.0006   -0.0020    0.0007   -0.0043         0
   -0.0118         0         0         0         0   -0.0026
         0   -0.0118         0         0         0    0.0016
   -0.0004    0.0002   -0.0057    0.0015   -0.0009         0
   -0.0117         0         0         0         0   -0.0026
         0   -0.0117         0         0         0    0.0029
   -0.0006    0.0003   -0.0065    0.0015   -0.0017         0
   -0.0115         0         0         0         0   -0.0026
         0   -0.0115         0         0         0    0.0043
   -0.0010    0.0005   -0.0066    0.0015   -0.0025         0
   -0.0057         0         0         0         0   -0.0013
         0   -0.0057         0         0         0    0.0028
    0.0007   -0.0003   -0.0033    0.0007   -0.0017         0
         0         0         0         0         0         0
         0         0         0         0         0         0
    0.0014   -0.0015   -0.0066    0.0015   -0.0041         0
         0         0         0         0         0         0
         0         0         0         0         0         0
   -0.0014    0.0002   -0.0024    0.0013   -0.0047         0
   -0.0115         0         0         0         0   -0.0039
         0   -0.0116         0         0         0    0.0009
   -0.0008    0.0004   -0.0065    0.0022   -0.0005         0
   -0.0115         0         0         0         0   -0.0039
         0   -0.0115         0         0         0    0.0023
   -0.0006    0.0012   -0.0066    0.0022   -0.0013         0
   -0.0114         0         0         0         0   -0.0039
         0   -0.0115         0         0         0    0.0036
   -0.0008    0.0005   -0.0064    0.0022   -0.0021         0
   -0.0114         0         0         0         0   -0.0039
         0   -0.0114         0         0         0    0.0050
    0.0013   -0.0006   -0.0068    0.0022   -0.0029         0
         0         0         0         0         0         0
         0         0         0         0         0         0
    0.0017   -0.0007   -0.0070    0.0022   -0.0037         0
         0         0         0         0         0         0
         0         0         0         0         0         0
   -0.0013    0.0005   -0.0055    0.0019   -0.0045         0
   -0.0114         0         0         0         0   -0.0053
         0   -0.0114         0         0         0    0.0016
   -0.0006    0.0009   -0.0060    0.0029   -0.0009         0
   -0.0114         0         0         0         0   -0.0053
         0   -0.0114         0         0         0    0.0029
    0.0001   -0.0003   -0.0068    0.0029   -0.0017         0
   -0.0113         0         0         0         0   -0.0053
         0   -0.0113         0         0         0    0.0043
    0.0012   -0.0016   -0.0072    0.0029   -0.0025         0
         0         0         0         0         0         0
         0         0         0         0         0         0
    0.0016   -0.0012   -0.0067    0.0029   -0.0033         0
         0         0         0         0         0         0
         0         0         0         0         0         0
   -0.0009    0.0006   -0.0059    0.0027   -0.0041         0
   -0.0113         0         0         0         0   -0.0066
         0   -0.0113         0         0         0    0.0009
   -0.0011   -0.0014   -0.0071    0.0036   -0.0005         0
   -0.0113         0         0         0         0   -0.0066
         0   -0.0113         0         0         0    0.0023
    0.0014   -0.0013   -0.0070    0.0036   -0.0013         0
         0         0         0         0         0         0
         0         0         0         0         0         0
    0.0005   -0.0017   -0.0064    0.0036   -0.0021         0
         0         0         0         0         0         0
         0         0         0         0         0         0
    0.0001   -0.0005   -0.0047    0.0035   -0.0029         0
         0         0         0         0         0         0
         0         0         0         0         0         0
   -0.0013    0.0011   -0.0048    0.0035   -0.0035         0
         0         0         0         0         0         0
         0         0         0         0         0         0
    0.0003   -0.0013   -0.0067    0.0044   -0.0003         0
         0         0         0         0         0         0
         0         0         0         0         0         0
    0.0000   -0.0016   -0.0069    0.0044   -0.0011         0
         0         0         0         0         0         0
         0         0         0         0         0         0
    0.0004   -0.0002   -0.0038    0.0041   -0.0019         0
         0         0         0         0         0         0
         0         0         0         0         0         0
   -0.0007    0.0015   -0.0060    0.0043   -0.0025         0
         0         0         0         0         0         0
         0         0         0         0         0         0
   -0.0004    0.0018   -0.0061    0.0051   -0.0004         0
         0         0         0         0         0         0
         0         0         0         0         0         0
   -0.0004    0.0013   -0.0056    0.0049   -0.0013         0
         0         0         0         0         0         0
         0         0         0         0         0         0
   -0.0004    0.0007   -0.0031    0.0047   -0.0019         0
   -0.0127         0         0         0         0   -0.0013
         0   -0.0128         0         0         0   -0.0009
    0.0015    0.0003   -0.0063    0.0007    0.0005         0
   -0.0122         0         0         0         0   -0.0013
         0   -0.0121         0         0         0   -0.0023
    0.0003    0.0001   -0.0063    0.0007    0.0013         0
   -0.0118         0         0         0         0   -0.0013
         0   -0.0118         0         0         0   -0.0036
    0.0009    0.0003   -0.0063    0.0007    0.0021         0
   -0.0116         0         0         0         0   -0.0013
         0   -0.0116         0         0         0   -0.0050
    0.0005    0.0002   -0.0066    0.0007    0.0029         0
   -0.0115         0         0         0         0   -0.0013
         0   -0.0115         0         0         0   -0.0063
   -0.0014    0.0000   -0.0072    0.0007    0.0037         0
         0         0         0         0         0         0
         0         0         0         0         0         0
   -0.0010    0.0006   -0.0020    0.0007    0.0043         0
   -0.0118         0         0         0         0   -0.0026
         0   -0.0118         0         0         0   -0.0016
    0.0004    0.0002   -0.0057    0.0015    0.0009         0
   -0.0117         0         0         0         0   -0.0026
         0   -0.0117         0         0         0   -0.0029
    0.0006    0.0003   -0.0065    0.0015    0.0017         0
   -0.0115         0         0         0         0   -0.0026
         0   -0.0115         0         0         0   -0.0043
    0.0010    0.0005   -0.0066    0.0015    0.0025         0
   -0.0114         0         0         0         0   -0.0026
         0   -0.0115         0         0         0   -0.0056
   -0.0013   -0.0006   -0.0067    0.0015    0.0033         0
         0         0         0         0         0         0
         0         0         0         0         0         0
   -0.0014   -0.0015   -0.0066    0.0015    0.0041         0
         0         0         0         0         0         0
         0         0         0         0         0         0
    0.0013    0.0002   -0.0024    0.0013    0.0047         0
   -0.0115         0         0         0         0   -0.0039
         0   -0.0116         0         0         0   -0.0009
    0.0008    0.0004   -0.0065    0.0022    0.0005         0
   -0.0115         0         0         0         0   -0.0039
         0   -0.0115         0         0         0   -0.0023
    0.0006    0.0012   -0.0066    0.0022    0.0013         0
   -0.0114         0         0         0         0   -0.0039
         0   -0.0115         0         0         0   -0.0036
    0.0008    0.0005   -0.0064    0.0022    0.0021         0
   -0.0114         0         0         0         0   -0.0039
         0   -0.0114         0         0         0   -0.0050
   -0.0013   -0.0006   -0.0068    0.0022    0.0029         0
         0         0         0         0         0         0
         0         0         0         0         0         0
   -0.0017   -0.0007   -0.0070    0.0022    0.0037         0
         0         0         0         0         0         0
         0         0         0         0         0         0
    0.0013    0.0005   -0.0055    0.0019    0.0045         0
   -0.0114         0         0         0         0   -0.0053
         0   -0.0114         0         0         0   -0.0016
    0.0006    0.0009   -0.0060    0.0029    0.0009         0
   -0.0114         0         0         0         0   -0.0053
         0   -0.0114         0         0         0   -0.0029
   -0.0001   -0.0003   -0.0068    0.0029    0.0017         0
   -0.0113         0         0         0         0   -0.0053
         0   -0.0113         0         0         0   -0.0043
   -0.0012   -0.0016   -0.0072    0.0029    0.0025         0
         0         0         0         0         0         0
         0         0         0         0         0         0
   -0.0016   -0.0012   -0.0067    0.0029    0.0033         0
         0         0         0         0         0         0
         0         0         0         0         0         0
    0.0009    0.0006   -0.0059    0.0027    0.0041         0
   -0.0113         0         0         0         0   -0.0066
         0   -0.0113         0         0         0   -0.0009
    0.0011   -0.0014   -0.0071    0.0036    0.0005         0
   -0.0113         0         0         0         0   -0.0066
         0   -0.0113         0         0         0   -0.0023
   -0.0014   -0.0013   -0.0070    0.0036    0.0013         0
         0         0         0         0         0         0
         0         0         0         0         0         0
   -0.0005   -0.0017   -0.0064    0.0036    0.0021         0
         0         0         0         0         0         0
         0         0         0         0         0         0
   -0.0001   -0.0005   -0.0047    0.0035    0.0029         0
         0         0         0         0         0         0
         0         0         0         0         0         0
    0.0013    0.0011   -0.0048    0.0035    0.0035         0
         0         0         0         0         0         0
         0         0         0         0         0         0
   -0.0003   -0.0013   -0.0067    0.0044    0.0003         0
         0         0         0         0         0         0
         0         0         0         0         0         0
   -0.0000   -0.0016   -0.0069    0.0044    0.0011         0
         0         0         0         0         0         0
         0         0         0         0         0         0
   -0.0004   -0.0002   -0.0038    0.0041    0.0019         0
         0         0         0         0         0         0
         0         0         0         0         0         0
    0.0007    0.0015   -0.0060    0.0043    0.0025         0
         0         0         0         0         0         0
         0         0         0         0         0         0
    0.0004    0.0018   -0.0061    0.0051    0.0004         0
         0         0         0         0         0         0
         0         0         0         0         0         0
    0.0004    0.0013   -0.0056    0.0049    0.0013         0
         0         0         0         0         0         0
         0         0         0         0         0         0
    0.0004    0.0007   -0.0031    0.0047    0.0019         0
   -0.0132         0         0         0         0   -0.0000
         0   -0.0131         0         0         0   -0.0016
    0.0009   -0.0000   -0.0057    0.0000    0.0009         0
   -0.0121         0         0         0         0   -0.0000
         0   -0.0121         0         0         0   -0.0029
    0.0002   -0.0000   -0.0064    0.0000    0.0017         0
   -0.0117         0         0         0         0    0.0000
         0   -0.0117         0         0         0   -0.0043
    0.0012   -0.0000   -0.0065   -0.0000    0.0025         0
   -0.0115         0         0         0         0   -0.0000
         0   -0.0115         0         0         0   -0.0056
   -0.0008   -0.0000   -0.0067    0.0000    0.0033         0
         0         0         0         0         0         0
         0         0         0         0         0         0
   -0.0013    0.0001   -0.0068   -0.0000    0.0041         0
         0         0         0         0         0         0
         0         0         0         0         0         0
    0.0008   -0.0000   -0.0056   -0.0000    0.0048         0
   -0.0127         0         0         0         0    0.0013
         0   -0.0128         0         0         0   -0.0009
    0.0015   -0.0003   -0.0063   -0.0007    0.0005         0
   -0.0122         0         0         0         0    0.0013
         0   -0.0121         0         0         0   -0.0023
    0.0003   -0.0002   -0.0063   -0.0007    0.0013         0
   -0.0118         0         0         0         0    0.0013
         0   -0.0118         0         0         0   -0.0036
    0.0009   -0.0003   -0.0063   -0.0007    0.0021         0
   -0.0116         0         0         0         0    0.0013
         0   -0.0116         0         0         0   -0.0050
    0.0005   -0.0002   -0.0066   -0.0007    0.0029         0
   -0.0115         0         0         0         0    0.0013
         0   -0.0115         0         0         0   -0.0063
   -0.0014    0.0000   -0.0072   -0.0007    0.0037         0
         0         0         0         0         0         0
         0         0         0         0         0         0
   -0.0011   -0.0005   -0.0020   -0.0007    0.0043         0
   -0.0118         0         0         0         0    0.0026
         0   -0.0118         0         0         0   -0.0016
    0.0004   -0.0002   -0.0058   -0.0015    0.0009         0
   -0.0117         0         0         0         0    0.0026
         0   -0.0117         0         0         0   -0.0029
    0.0006   -0.0003   -0.0065   -0.0015    0.0017         0
   -0.0115         0         0         0         0    0.0026
         0   -0.0115         0         0         0   -0.0043
    0.0009   -0.0005   -0.0066   -0.0015    0.0025         0
   -0.0115         0         0         0         0    0.0026
         0   -0.0115         0         0         0   -0.0056
   -0.0014    0.0006   -0.0067   -0.0015    0.0033         0
         0         0         0         0         0         0
         0         0         0         0         0         0
   -0.0014    0.0016   -0.0067   -0.0015    0.0041         0
         0         0         0         0         0         0
         0         0         0         0         0         0
    0.0014   -0.0003   -0.0024   -0.0013    0.0047         0
   -0.0116         0         0         0         0    0.0039
         0   -0.0116         0         0         0   -0.0009
    0.0009   -0.0003   -0.0066   -0.0022    0.0005         0
   -0.0115         0         0         0         0    0.0039
         0   -0.0115         0         0         0   -0.0023
    0.0006   -0.0012   -0.0066   -0.0022    0.0013         0
   -0.0115         0         0         0         0    0.0039
         0   -0.0115         0         0         0   -0.0036
    0.0008   -0.0005   -0.0064   -0.0022    0.0021         0
   -0.0114         0         0         0         0    0.0039
         0   -0.0114         0         0         0   -0.0050
   -0.0013    0.0006   -0.0069   -0.0022    0.0029         0
         0         0         0         0         0         0
         0         0         0         0         0         0
   -0.0017    0.0007   -0.0070   -0.0022    0.0037         0
         0         0         0         0         0         0
         0         0         0         0         0         0
    0.0014   -0.0005   -0.0055   -0.0019    0.0045         0
   -0.0114         0         0         0         0    0.0053
         0   -0.0114         0         0         0   -0.0016
    0.0006   -0.0008   -0.0060   -0.0029    0.0009         0
   -0.0114         0         0         0         0    0.0053
         0   -0.0114         0         0         0   -0.0029
   -0.0001    0.0003   -0.0069   -0.0029    0.0017         0
   -0.0114         0         0         0         0    0.0053
         0   -0.0114         0         0         0   -0.0043
   -0.0012    0.0016   -0.0072   -0.0029    0.0025         0
         0         0         0         0         0         0
         0         0         0         0         0         0
   -0.0016    0.0012   -0.0067   -0.0029    0.0033         0
         0         0         0         0         0         0
         0         0         0         0         0         0
    0.0009   -0.0006   -0.0059   -0.0027    0.0041         0
   -0.0113         0         0         0         0    0.0066
         0   -0.0113         0         0         0   -0.0009
    0.0012    0.0014   -0.0071   -0.0036    0.0005         0
   -0.0113         0         0         0         0    0.0066
         0   -0.0113         0         0         0   -0.0023
   -0.0014    0.0013   -0.0071   -0.0036    0.0013         0
         0         0         0         0         0         0
         0         0         0         0         0         0
   -0.0004    0.0018   -0.0064   -0.0036    0.0021         0
         0         0         0         0         0         0
         0         0         0         0         0         0
   -0.0001    0.0005   -0.0047   -0.0035    0.0029         0
         0         0         0         0         0         0
         0         0         0         0         0         0
    0.0013   -0.0011   -0.0048   -0.0035    0.0035         0
         0         0         0         0         0         0
         0         0         0         0         0         0
   -0.0003    0.0014   -0.0068   -0.0044    0.0003         0
         0         0         0         0         0         0
         0         0         0         0         0         0
    0.0000    0.0017   -0.0070   -0.0044    0.0011         0
         0         0         0         0         0         0
         0         0         0         0         0         0
   -0.0004    0.0002   -0.0039   -0.0041    0.0019         0
         0         0         0         0         0         0
         0         0         0         0         0         0
    0.0007   -0.0016   -0.0060   -0.0043    0.0025         0
         0         0         0         0         0         0
         0         0         0         0         0         0
    0.0004   -0.0019   -0.0061   -0.0051    0.0004         0
         0         0         0         0         0         0
         0         0         0         0         0         0
    0.0004   -0.0014   -0.0056   -0.0049    0.0013         0
         0         0         0         0         0         0
         0         0         0         0         0         0
    0.0004   -0.0007   -0.0031   -0.0047    0.0019         0
   -0.0127         0         0         0         0    0.0013
         0   -0.0128         0         0         0    0.0009
   -0.0015   -0.0003   -0.0063   -0.0007   -0.0005         0
   -0.0122         0         0         0         0    0.0013
         0   -0.0121         0         0         0    0.0023
   -0.0003   -0.0002   -0.0063   -0.0007   -0.0013         0
   -0.0118         0         0         0         0    0.0013
         0   -0.0118         0         0         0    0.0036
   -0.0009   -0.0003   -0.0063   -0.0007   -0.0021         0
   -0.0116         0         0         0         0    0.0013
         0   -0.0116         0         0         0    0.0050
   -0.0005   -0.0002   -0.0066   -0.0007   -0.0029         0
   -0.0115         0         0         0         0    0.0013
         0   -0.0115         0         0         0    0.0063
    0.0014    0.0000   -0.0072   -0.0007   -0.0037         0
         0         0         0         0         0         0
         0         0         0         0         0         0
    0.0011   -0.0005   -0.0020   -0.0007   -0.0043         0
   -0.0118         0         0         0         0    0.0026
         0   -0.0118         0         0         0    0.0016
   -0.0004   -0.0002   -0.0058   -0.0015   -0.0009         0
   -0.0117         0         0         0         0    0.0026
         0   -0.0117         0         0         0    0.0029
   -0.0006   -0.0003   -0.0065   -0.0015   -0.0017         0
   -0.0115         0         0         0         0    0.0026
         0   -0.0115         0         0         0    0.0043
   -0.0009   -0.0005   -0.0066   -0.0015   -0.0025         0
   -0.0115         0         0         0         0    0.0026
         0   -0.0115         0         0         0    0.0056
    0.0014    0.0006   -0.0067   -0.0015   -0.0033         0
         0         0         0         0         0         0
         0         0         0         0         0         0
    0.0014    0.0016   -0.0067   -0.0015   -0.0041         0
         0         0         0         0         0         0
         0         0         0         0         0         0
   -0.0014   -0.0003   -0.0024   -0.0013   -0.0047         0
   -0.0116         0         0         0         0    0.0039
         0   -0.0116         0         0         0    0.0009
   -0.0009   -0.0003   -0.0066   -0.0022   -0.0005         0
   -0.0115         0         0         0         0    0.0039
         0   -0.0115         0         0         0    0.0023
   -0.0006   -0.0012   -0.0066   -0.0022   -0.0013         0
   -0.0115         0         0         0         0    0.0039
         0   -0.0115         0         0         0    0.0036
   -0.0008   -0.0005   -0.0064   -0.0022   -0.0021         0
   -0.0114         0         0         0         0    0.0039
         0   -0.0114         0         0         0    0.0050
    0.0013    0.0006   -0.0069   -0.0022   -0.0029         0
         0         0         0         0         0         0
         0         0         0         0         0         0
    0.0017    0.0007   -0.0070   -0.0022   -0.0037         0
         0         0         0         0         0         0
         0         0         0         0         0         0
   -0.0014   -0.0005   -0.0055   -0.0019   -0.0045         0
   -0.0114         0         0         0         0    0.0053
         0   -0.0114         0         0         0    0.0016
   -0.0006   -0.0008   -0.0060   -0.0029   -0.0009         0
   -0.0114         0         0         0         0    0.0053
         0   -0.0114         0         0         0    0.0029
    0.0001    0.0003   -0.0069   -0.0029   -0.0017         0
   -0.0114         0         0         0         0    0.0053
         0   -0.0114         0         0         0    0.0043
    0.0012    0.0016   -0.0072   -0.0029   -0.0025         0
         0         0         0         0         0         0
         0         0         0         0         0         0
    0.0016    0.0012   -0.0067   -0.0029   -0.0033         0
         0         0         0         0         0         0
         0         0         0         0         0         0
   -0.0009   -0.0006   -0.0059   -0.0027   -0.0041         0
   -0.0113         0         0         0         0    0.0066
         0   -0.0113         0         0         0    0.0009
   -0.0012    0.0014   -0.0071   -0.0036   -0.0005         0
   -0.0113         0         0         0         0    0.0066
         0   -0.0113         0         0         0    0.0023
    0.0014    0.0013   -0.0071   -0.0036   -0.0013         0
         0         0         0         0         0         0
         0         0         0         0         0         0
    0.0004    0.0018   -0.0064   -0.0036   -0.0021         0
         0         0         0         0         0         0
         0         0         0         0         0         0
    0.0001    0.0005   -0.0047   -0.0035   -0.0029         0
         0         0         0         0         0         0
         0         0         0         0         0         0
   -0.0013   -0.0011   -0.0048   -0.0035   -0.0035         0
         0         0         0         0         0         0
         0         0         0         0         0         0
    0.0003    0.0014   -0.0068   -0.0044   -0.0003         0
         0         0         0         0         0         0
         0         0         0         0         0         0
   -0.0000    0.0017   -0.0070   -0.0044   -0.0011         0
         0         0         0         0         0         0
         0         0         0         0         0         0
    0.0004    0.0002   -0.0039   -0.0041   -0.0019         0
         0         0         0         0         0         0
         0         0         0         0         0         0
   -0.0007   -0.0016   -0.0060   -0.0043   -0.0025         0
         0         0         0         0         0         0
         0         0         0         0         0         0
   -0.0004   -0.0019   -0.0061   -0.0051   -0.0004         0
         0         0         0         0         0         0
         0         0         0         0         0         0
   -0.0004   -0.0014   -0.0056   -0.0049   -0.0013         0
         0         0         0         0         0         0
         0         0         0         0         0         0
   -0.0004   -0.0007   -0.0031   -0.0047   -0.0019         0
         0         0         0         0         0         0
         0         0         0         0         0         0
   -0.0009    0.0001   -0.0058    0.0007   -0.0047         0
         0         0         0         0         0         0
         0         0         0         0         0         0
   -0.0005    0.0006   -0.0030    0.0039   -0.0030         0
         0         0         0         0         0         0
         0         0         0         0         0         0
    0.0009    0.0002   -0.0058    0.0007    0.0047         0
         0         0         0         0         0         0
         0         0         0         0         0         0
    0.0005    0.0006   -0.0030    0.0039    0.0030         0
         0         0         0         0         0         0
         0         0         0         0         0         0
    0.0010   -0.0002   -0.0058   -0.0007    0.0047         0
         0         0         0         0         0         0
         0         0         0         0         0         0
    0.0005   -0.0006   -0.0030   -0.0039    0.0030         0
         0         0         0         0         0         0
         0         0         0         0         0         0
   -0.0010   -0.0002   -0.0058   -0.0007   -0.0047         0
         0         0         0         0         0         0
         0         0         0         0         0         0
   -0.0005   -0.0006   -0.0030   -0.0039   -0.0030         0
   -0.0135         0         0         0         0   -0.0000
         0   -0.0135         0         0         0         0
    0.0000   -0.0000   -0.0102    0.0000         0         0
   -0.0135         0         0         0         0    0.0026
         0   -0.0135         0         0         0         0
    0.0000   -0.0009   -0.0104   -0.0015         0         0
   -0.0135         0         0         0         0    0.0053
         0   -0.0135         0         0         0         0
   -0.0000   -0.0010   -0.0110   -0.0029         0         0
   -0.0135         0         0         0         0   -0.0026
         0   -0.0135         0         0         0         0
   -0.0000    0.0009   -0.0104    0.0015         0         0
   -0.0135         0         0         0         0   -0.0053
         0   -0.0135         0         0         0         0
   -0.0000    0.0010   -0.0109    0.0029         0         0
   -0.0057         0         0         0         0   -0.0013
         0   -0.0057         0         0         0    0.0028
    0.0007   -0.0003   -0.0033    0.0007   -0.0017         0
   -0.0061         0         0         0         0   -0.0007
         0   -0.0061         0         0         0    0.0011
   -0.0002    0.0001   -0.0032    0.0004   -0.0007         0
   -0.0059         0         0         0         0   -0.0007
         0   -0.0059         0         0         0    0.0018
   -0.0005    0.0002   -0.0031    0.0004   -0.0011         0
   -0.0058         0         0         0         0   -0.0007
         0   -0.0058         0         0         0    0.0025
   -0.0003    0.0001   -0.0033    0.0004   -0.0015         0
   -0.0057         0         0         0         0   -0.0007
         0   -0.0057         0         0         0    0.0032
    0.0007    0.0000   -0.0036    0.0004   -0.0019         0];

sign_matrix = [-1    -1    -1
    -1    -1    -1
    -1    -1    -1
    -1    -1    -1
     1     1    -1
     1     1    -1
    -1    -1    -1
    -1    -1    -1
    -1    -1    -1
    -1    -1    -1
    -1    -1    -1
     1     1    -1
    -1    -1    -1
    -1    -1    -1
    -1    -1    -1
    -1    -1    -1
     1     1    -1
     1     1    -1
    -1    -1    -1
    -1    -1    -1
    -1    -1    -1
    -1    -1    -1
     1     1    -1
     1     1    -1
    -1    -1    -1
    -1    -1    -1
    -1    -1    -1
     1     1    -1
     1     1    -1
    -1    -1    -1
    -1    -1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
    -1    -1    -1
    -1    -1    -1
    -1    -1    -1
    -1    -1    -1
    -1    -1    -1
     1     1    -1
    -1    -1    -1
    -1    -1    -1
    -1    -1    -1
    -1    -1    -1
     1     1    -1
     1     1    -1
    -1    -1    -1
    -1    -1    -1
    -1    -1    -1
    -1    -1    -1
     1     1    -1
     1     1    -1
    -1    -1    -1
    -1    -1    -1
    -1    -1    -1
     1     1    -1
     1     1    -1
    -1    -1    -1
    -1    -1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
     1     1    -1
    -1    -1    -1
    -1    -1    -1
    -1    -1    -1
    -1    -1    -1
    -1    -1    -1];

% position M1B to HP coordinate system
XYZ2HP = [-0.45302	0.517744	-0.72575	1.934433	-1.14293	-2.02285;
0.453021	0.517744	-0.72575	1.934433	1.14293	2.02285;
-0.22187	-0.6512	-0.72575	0.02259	2.246733	-2.02285;
-0.67489	0.133456	-0.72575	-1.95702	1.103803	2.02285;
0.67489	0.133456	-0.72575	-1.95702	-1.1038	-2.02285;
0.221869	-0.6512	-0.72575	0.02259	-2.24673	2.02285];

H = -XYZ2HP; % M1B XYZ to M1B HP

% force
HP2XYZ = [-0.45302	0.45302	-0.22187	-0.67489	0.67489	0.22187
0.51774	0.51774	-0.65120	0.13346	0.13346	-0.65120
-0.72575	-0.72575	-0.72575	-0.72575	-0.72575	-0.72575
1.93443	1.93443	0.02259	-1.95702	-1.95702	0.02259
-1.14293	1.14293	2.24673	1.10380	-1.10380	-2.24673
-2.02285	2.02285	-2.02285	2.02285	-2.02285	2.02285];

Th = -HP2XYZ; % M1B XYZ to M1B HP


% *Equivalent static supports SS*
% Ks_eq = 2.5e5*110; % equivalent static support stiffness
X_ss_gap = [8e-3 8e-3 6.5e-3 8e-3 8e-3 6.5e-3 8e-3 8e-3 6.5e-3]';
Xm_gap = [8e-3 8e-3 6.5e-3 0 0 0]';

sr1y = 3; sr1x = 0;
sr2x = 3*cosd(210);sr2y = 3*sind(210);
sr3x = 3*cosd(330);sr3y = 3*sind(330);

S2M = [1 0 0 1 0 0 1 0 0;
         0 1 0 0 1 0 0 1 0;
         0 0 1 0 0 1 0 0 1;
         0 0 sr1y 0 0 sr2y 0 0 sr3y;
         0 0 -sr1x 0 0 -sr2x 0 0 -sr3x;
         -sr1y sr1x 0 -sr2y sr2x 0 -sr3y sr3x 0];
% M2S = pinv(S2M);
Ts =     S2M;
ds2dm = [1/3 0 0 1/3 0 0 1/3 0 0;
         0 1/3 0 0 1/3 0 0 1/3 0;
         0 0 1/3 0 0 1/3 0 0 1/3;
         0 0 sr1y 0 0 sr2y 0 0 sr3y;
         0 0 -sr1x 0 0 -sr2x 0 0 -sr3x;
         -sr1y sr1x  0 -sr2y sr2x 0 -sr3y sr3x 0];
S = pinv(ds2dm);

%% initialize arrays
alpha_vec = 0.001*(0:0.001:1.5)';
nalpha = length(alpha_vec);
Fxyz = zeros(170,3,nalpha);
Xm = zeros(6,nalpha);
Xha = zeros(6,nalpha);
Fh_r = zeros(6,nalpha);
Ks_vec = zeros(9,9,nalpha);
Kh_vec = zeros(6,6,nalpha);
foo = zeros(6,nalpha);

% initial condition
Fss = Force_M2S(-([Fg;0;0;0])); % static support reaction force
Xs = ss_compression_tension(Fss); % static support compression/tension under mirror weight
Xs = Xs + sign(Xs).*X_ss_gap;
Xm(:,1) = Slength2Mlength(Xs); % mirror position
Xs0 = sign(Xs).*X_ss_gap;
Xha(:,1) = dm2dh(Slength2Mlength(Xs0));
Fu = zeros(6,1); % integrator accumulator
dt = 1; % sample time for integrator
ki = 500/120e5; % integrator gain
alpha = 0;
slope = 0;
%% simulator loop


for k = 1 : 2000
    % DCS force
    alpha = alpha+slope;
    FM = alpha*FMg;
    Fxyz_d = K*FM;
    nc = size(FM,2);
    na = 170;
    Fxyz_v = reshape(Fxyz_d,[3,na])';
    Fxyz(:,:,k) = reshape(Fxyz_v,[na*nc,3]);
    Fxyz(:,:,k) = Fxyz(:,:,k).*sign_matrix; % convert to actuator local coordinate system.
    
    % simulator
    Fxyz(:,:,k) = sign_matrix.*Fxyz(:,:,k);
    Fxyz_s = node_rearangement(squeeze(Fxyz(:,:,k)));
%     Xha(:,k) = Xha(:,k)*1e-3; % millimeter to meter
%     Xha(:,k) = -Xha(:,k); % HP to M1 B coordinates
    % static support stiffness update

    Xs = Mlength2Slength(Xm(:,k)); % mirror position at equivalent static supports
    Ks = ss_stiffness(Xs);
    % Support actuator force and moment applied
    
    FMa = ActForces2FM(squeeze(Fxyz_s));
    % hardpoint force
    % during chase
    Xh_r = dm2dh(Xm(:,k));
    [~, Kh, Fhbk] = hp_stiffness(Xh_r,Xha(:,k));
    
    % after chase
%     if (FMg+FMa) < 100
%         Kh = 120e6*eye(6);
%         Fhbk = zeros(6,1);
%     end
    
    Xm(:,k+1) = pinv(Ts*Ks*S + Th*Kh*H)*(FMg + FMa + Ts*Ks*(sign(Xs).*X_ss_gap) + Th*Kh*Xha(:,k) + Th*Fhbk );
    
    
    % hardopint reaction force and breakaway encoder update
%     Xh_r = dm2dh(Xm(:,k+1));
    [Fh_r(:,k), ~, ~] = hp_stiffness(Xh_r,Xha(:,k));
    
    % update variables
    Fa_prev = FMa;
%     Xm(:,k+1) = Xm(:,k);
    Fxyz_r = Fxyz_s; % change it to local actuator coordinate system
    if alpha >0.99
        Xha(:,k+1) = -4.7174*ones(6,1);
    else
        Xha(:,k+1) = dm2dh(Xm(:,k+1)); % change it to HP coordinate system
        
    end
    
    Fu = (-Fh_r(:,k)/dt+Fu);
    Xha(:,k+1) = Xha(:,k)+1e-6;
    
    Ks_vec(:,:,k) = Ks;
    Kh_vec(:,:,k) = Kh;
    foo(:,k) = (FMg + FMa);
end

tn = (1:1:length(Xm))';
figure(1);
% plot(tn(1:end),Xha(3,:)');
plot(tn(2:end),Fh_r(3,:)');


% %% initial down condition
% [~, ~, FMg] = decompose_gravity_vector(t,clk,zenith); % decompose gravity vector
% 
% if isempty(Xm_prev)
%     Fss = Force_M2S(-(FMg+Fa_prev)); % static support reaction force
%     Xs = ss_compression_tension(Fss); % static support compression/tension under mirror weight
%     Xs = Xs + sign(Xs).*X_ss_gap;
%     Xm_prev = Slength2Mlength(Xs); % mirror position 
%     Xs0 = sign(Xs).*X_ss_gap;
%     Xha = dm2dh(Slength2Mlength(Xs0));
% end
% if isempty(Xha)
%     Xha = dm2dh(Slength2Mlength(Xs0));
% end
% 
% %% static support stiffness update
% 
% Xs = Mlength2Slength(Xm_prev); % mirror position at equivalent static supports
% Ks = ss_stiffness(Xs);
% 
% %% Support actuator force and moment applied
% 
% FMa = ActForces2FM(Fxyz);
% 
% %% hardpoint force
% % during chase
% Xh_r = dm2dh(Xm_prev);
% [~, Kh, Fhbk] = hp_stiffness(Xh_r,Xha);
% 
% % after chase
% if (FMg+FMa) < 100 
%     Kh = 120e6*eye(6);
%     Fhbk = zeros(6,1);
% end
% 
% Xm = pinv(Ts*Ks*S + Th*Kh*H)*(FMg + FMa + Ts*Ks*(sign(Xs).*X_ss_gap) + Th*Kh*Xha + Th*Fhbk );
% 
% 
% %% hardopint reaction force and breakaway encoder update
% Xh_r = dm2dh(Xm);
% [Fh_r, ~, ~] = hp_stiffness(Xh_r,Xha);
% 
% %% update variables
% Fa_prev = FMa;
% Xm_prev = Xm;
% Fxyz_r = sign_matrix.*Fxyz; % change it to local actuator coordinate system
% Xha_r = -Xha; % change it to HP coordinate system